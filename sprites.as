//Dark walking right
const string EMBED_dark0r = "sans/spr_sans_r_dark_0.png";
const string EMBED_dark1r = "sans/spr_sans_r_dark_1.png";
const string EMBED_dark2r = "sans/spr_sans_r_dark_2.png";
const string EMBED_dark3r = "sans/spr_sans_r_dark_3.png";

//Faces
const string EMBED_bface0 = "sans/spr_sans_bface_0.png";
const string EMBED_bface1 = "sans/spr_sans_bface_1.png";
const string EMBED_bface2 = "sans/spr_sans_bface_2.png";
const string EMBED_bface3 = "sans/spr_sans_bface_3.png";
const string EMBED_bface4 = "sans/spr_sans_bface_4.png";
const string EMBED_bface5 = "sans/spr_sans_bface_5.png";
const string EMBED_bface6 = "sans/spr_sans_bface_6.png";
const string EMBED_bface7 = "sans/spr_sans_bface_7.png";
const string EMBED_bface8 = "sans/spr_sans_bface_8.png";
const string EMBED_bface9 = "sans/spr_sans_bface_9.png";
const string EMBED_bface10 = "sans/spr_sans_bface_10.png";
const string EMBED_bface11 = "sans/spr_sans_bface_11.png";
const string EMBED_bface12 = "sans/spr_sans_bface_12.png";
const string EMBED_bface13 = "sans/spr_sans_bface_13.png";
const string EMBED_bface14 = "sans/spr_sans_bface_14.png";

//Font
const string EMBED_text0000 = "sanstext/sansFontsSpritesheet_0000.png";
const string EMBED_text0001 = "sanstext/sansFontsSpritesheet_0001.png";
const string EMBED_text0002 = "sanstext/sansFontsSpritesheet_0002.png";
const string EMBED_text0003 = "sanstext/sansFontsSpritesheet_0003.png";
const string EMBED_text0004 = "sanstext/sansFontsSpritesheet_0004.png";
const string EMBED_text0005 = "sanstext/sansFontsSpritesheet_0005.png";
const string EMBED_text0006 = "sanstext/sansFontsSpritesheet_0006.png";
const string EMBED_text0007 = "sanstext/sansFontsSpritesheet_0007.png";
const string EMBED_text0008 = "sanstext/sansFontsSpritesheet_0008.png";
const string EMBED_text0009 = "sanstext/sansFontsSpritesheet_0009.png";
const string EMBED_text0010 = "sanstext/sansFontsSpritesheet_0010.png";
const string EMBED_text0011 = "sanstext/sansFontsSpritesheet_0011.png";
const string EMBED_text0012 = "sanstext/sansFontsSpritesheet_0012.png";
const string EMBED_text0013 = "sanstext/sansFontsSpritesheet_0013.png";
const string EMBED_text0014 = "sanstext/sansFontsSpritesheet_0014.png";
const string EMBED_text0015 = "sanstext/sansFontsSpritesheet_0015.png";
const string EMBED_text0016 = "sanstext/sansFontsSpritesheet_0016.png";
const string EMBED_text0017 = "sanstext/sansFontsSpritesheet_0017.png";
const string EMBED_text0018 = "sanstext/sansFontsSpritesheet_0018.png";
const string EMBED_text0019 = "sanstext/sansFontsSpritesheet_0019.png";
const string EMBED_text0020 = "sanstext/sansFontsSpritesheet_0020.png";
const string EMBED_text0021 = "sanstext/sansFontsSpritesheet_0021.png";
const string EMBED_text0022 = "sanstext/sansFontsSpritesheet_0022.png";
const string EMBED_text0023 = "sanstext/sansFontsSpritesheet_0023.png";
const string EMBED_text0024 = "sanstext/sansFontsSpritesheet_0024.png";
const string EMBED_text0025 = "sanstext/sansFontsSpritesheet_0025.png";
const string EMBED_text0026 = "sanstext/sansFontsSpritesheet_0026.png";
const string EMBED_text0027 = "sanstext/sansFontsSpritesheet_0027.png";
const string EMBED_text0028 = "sanstext/sansFontsSpritesheet_0028.png";
const string EMBED_text0029 = "sanstext/sansFontsSpritesheet_0029.png";
const string EMBED_text0030 = "sanstext/sansFontsSpritesheet_0030.png";
const string EMBED_text0031 = "sanstext/sansFontsSpritesheet_0031.png";
const string EMBED_text0032 = "sanstext/sansFontsSpritesheet_0032.png";
const string EMBED_text0033 = "sanstext/sansFontsSpritesheet_0033.png";
const string EMBED_text0034 = "sanstext/sansFontsSpritesheet_0034.png";
const string EMBED_text0035 = "sanstext/sansFontsSpritesheet_0035.png";
const string EMBED_text0036 = "sanstext/sansFontsSpritesheet_0036.png";
const string EMBED_text0037 = "sanstext/sansFontsSpritesheet_0037.png";
const string EMBED_text0038 = "sanstext/sansFontsSpritesheet_0038.png";
const string EMBED_text0039 = "sanstext/sansFontsSpritesheet_0039.png";
const string EMBED_text0040 = "sanstext/sansFontsSpritesheet_0040.png";
const string EMBED_text0041 = "sanstext/sansFontsSpritesheet_0041.png";
const string EMBED_text0042 = "sanstext/sansFontsSpritesheet_0042.png";
const string EMBED_text0043 = "sanstext/sansFontsSpritesheet_0043.png";
const string EMBED_text0044 = "sanstext/sansFontsSpritesheet_0044.png";
const string EMBED_text0045 = "sanstext/sansFontsSpritesheet_0045.png";
const string EMBED_text0046 = "sanstext/sansFontsSpritesheet_0046.png";
const string EMBED_text0047 = "sanstext/sansFontsSpritesheet_0047.png";
const string EMBED_text0048 = "sanstext/sansFontsSpritesheet_0048.png";
const string EMBED_text0049 = "sanstext/sansFontsSpritesheet_0049.png";
const string EMBED_text0050 = "sanstext/sansFontsSpritesheet_0050.png";
const string EMBED_text0051 = "sanstext/sansFontsSpritesheet_0051.png";
const string EMBED_text0052 = "sanstext/sansFontsSpritesheet_0052.png";
const string EMBED_text0053 = "sanstext/sansFontsSpritesheet_0053.png";
const string EMBED_text0054 = "sanstext/sansFontsSpritesheet_0054.png";
const string EMBED_text0055 = "sanstext/sansFontsSpritesheet_0055.png";
const string EMBED_text0056 = "sanstext/sansFontsSpritesheet_0056.png";
const string EMBED_text0057 = "sanstext/sansFontsSpritesheet_0057.png";
const string EMBED_text0058 = "sanstext/sansFontsSpritesheet_0058.png";
const string EMBED_text0059 = "sanstext/sansFontsSpritesheet_0059.png";
const string EMBED_text0060 = "sanstext/sansFontsSpritesheet_0060.png";
const string EMBED_text0061 = "sanstext/sansFontsSpritesheet_0061.png";
const string EMBED_text0062 = "sanstext/sansFontsSpritesheet_0062.png";
const string EMBED_text0063 = "sanstext/sansFontsSpritesheet_0063.png";
const string EMBED_text0064 = "sanstext/sansFontsSpritesheet_0064.png";
const string EMBED_text0065 = "sanstext/sansFontsSpritesheet_0065.png";
const string EMBED_text0066 = "sanstext/sansFontsSpritesheet_0066.png";
const string EMBED_text0067 = "sanstext/sansFontsSpritesheet_0067.png";
const string EMBED_text0068 = "sanstext/sansFontsSpritesheet_0068.png";
const string EMBED_text0069 = "sanstext/sansFontsSpritesheet_0069.png";
const string EMBED_text0070 = "sanstext/sansFontsSpritesheet_0070.png";
const string EMBED_text0071 = "sanstext/sansFontsSpritesheet_0071.png";
const string EMBED_text0072 = "sanstext/sansFontsSpritesheet_0072.png";
const string EMBED_text0073 = "sanstext/sansFontsSpritesheet_0073.png";
const string EMBED_text0074 = "sanstext/sansFontsSpritesheet_0074.png";
const string EMBED_text0075 = "sanstext/sansFontsSpritesheet_0075.png";
const string EMBED_text0076 = "sanstext/sansFontsSpritesheet_0076.png";
const string EMBED_text0077 = "sanstext/sansFontsSpritesheet_0077.png";
const string EMBED_text0078 = "sanstext/sansFontsSpritesheet_0078.png";
const string EMBED_text0079 = "sanstext/sansFontsSpritesheet_0079.png";
const string EMBED_text0080 = "sanstext/sansFontsSpritesheet_0080.png";
const string EMBED_text0081 = "sanstext/sansFontsSpritesheet_0081.png";
const string EMBED_text0082 = "sanstext/sansFontsSpritesheet_0082.png";
const string EMBED_text0083 = "sanstext/sansFontsSpritesheet_0083.png";
const string EMBED_text0084 = "sanstext/sansFontsSpritesheet_0084.png";
const string EMBED_text0085 = "sanstext/sansFontsSpritesheet_0085.png";
const string EMBED_text0086 = "sanstext/sansFontsSpritesheet_0086.png";
const string EMBED_text0087 = "sanstext/sansFontsSpritesheet_0087.png";
const string EMBED_text0088 = "sanstext/sansFontsSpritesheet_0088.png";
const string EMBED_text0089 = "sanstext/sansFontsSpritesheet_0089.png";
const string EMBED_text0090 = "sanstext/sansFontsSpritesheet_0090.png";
const string EMBED_text0091 = "sanstext/sansFontsSpritesheet_0091.png";
const string EMBED_text0092 = "sanstext/sansFontsSpritesheet_0092.png";
const string EMBED_text0093 = "sanstext/sansFontsSpritesheet_0093.png";
const string EMBED_text0094 = "sanstext/sansFontsSpritesheet_0094.png";
const string EMBED_text0095 = "sanstext/sansFontsSpritesheet_0095.png";
const string EMBED_text0096 = "sanstext/sansFontsSpritesheet_0096.png";
const string EMBED_text0097 = "sanstext/sansFontsSpritesheet_0097.png";
const string EMBED_text0098 = "sanstext/sansFontsSpritesheet_0098.png";
const string EMBED_text0099 = "sanstext/sansFontsSpritesheet_0099.png";
const string EMBED_text0100 = "sanstext/sansFontsSpritesheet_0100.png";
const string EMBED_text0101 = "sanstext/sansFontsSpritesheet_0101.png";

//const string EMBED_test2 = "test2.png";


class script {
  scene@ g;
  int frame_count;
  sprites@ spr;
  [hidden] int Y1;
  [position,mode:world,layer:19,y:Y1] int X1;
  sansSprite@ sansAnimator;
  array<string>sansWalkR(4);
  array<string>sansFace(15);
  array<string>fontSprites(102);

  script() {
    array<string>sansWalkR = {"dark0r","dark1r","dark2r","dark3r"};

    array<string>sansFace = {"bface0","bface1","bface2","bface3","bface4",
                            "bface5","bface6","bface7","bface8","bface9",
                            "bface10","bface11","bface12","bface13","bface14"};
    array<string>fontSprites = {"text0000","text0001","text0002","text0003","text0004","text0005","text0006","text0007","text0008","text0009","text0010",
                         "text0011","text0012","text0013","text0014","text0015","text0016","text0017","text0018","text0019",
                         "text0020","text0021","text0022","text0023","text0024","text0025","text0026","text0027","text0028",
                         "text0029","text0030","text0031","text0032","text0033","text0034","text0035","text0036","text0037",
                         "text0038","text0039","text0040","text0041","text0042","text0043","text0044","text0045","text0046",
                         "text0047","text0048","text0049","text0050","text0051","text0052","text0053","text0054","text0055",
                         "text0056","text0057","text0058","text0059","text0060","text0061","text0062","text0063","text0064",
                         "text0065","text0066","text0067","text0068","text0069","text0070","text0071","text0072","text0073",
                         "text0074","text0075","text0076","text0077","text0078","text0079","text0080","text0081","text0082",
                         "text0083","text0084","text0085","text0086","text0087","text0088","text0089","text0090","text0091",
                         "text0092","text0093","text0094","text0095","text0096","text0097","text0098","text0099","text0100","text0101"};

    @g = get_scene();
    frame_count = 0;
    @spr = create_sprites();
    @sansAnimator = sansSprite(sansWalkR, sansFace, fontSprites);
  }

  void build_sprites(message@ msg) {
    //Build walking right in the dark sprites
    msg.set_string("dark0r","dark0r");
    msg.set_string("dark1r","dark1r");
    msg.set_string("dark2r","dark2r");
    msg.set_string("dark3r","dark3r");

    //Build face sprites
    msg.set_string("bface0","bface0");
    msg.set_string("bface1","bface1");
    msg.set_string("bface2","bface2");
    msg.set_string("bface3","bface3");
    msg.set_string("bface4","bface4");
    msg.set_string("bface5","bface5");
    msg.set_string("bface6","bface6");
    msg.set_string("bface7","bface7");
    msg.set_string("bface8","bface8");
    msg.set_string("bface9","bface9");
    msg.set_string("bface10","bface10");
    msg.set_string("bface11","bface11");
    msg.set_string("bface12","bface12");
    msg.set_string("bface13","bface13");
    msg.set_string("bface14","bface14");

    //Build font sprites
    msg.set_string("text0000","text0000");
    msg.set_string("text0001","text0001");
    msg.set_string("text0002","text0002");
    msg.set_string("text0003","text0003");
    msg.set_string("text0004","text0004");
    msg.set_string("text0005","text0005");
    msg.set_string("text0006","text0006");
    msg.set_string("text0007","text0007");
    msg.set_string("text0008","text0008");
    msg.set_string("text0009","text0009");
    msg.set_string("text0010","text0010");
    msg.set_string("text0011","text0011");
    msg.set_string("text0012","text0012");
    msg.set_string("text0013","text0013");
    msg.set_string("text0014","text0014");
    msg.set_string("text0015","text0015");
    msg.set_string("text0016","text0016");
    msg.set_string("text0017","text0017");
    msg.set_string("text0018","text0018");
    msg.set_string("text0019","text0019");
    msg.set_string("text0020","text0020");
    msg.set_string("text0021","text0021");
    msg.set_string("text0022","text0022");
    msg.set_string("text0023","text0023");
    msg.set_string("text0024","text0024");
    msg.set_string("text0025","text0025");
    msg.set_string("text0026","text0026");
    msg.set_string("text0027","text0027");
    msg.set_string("text0028","text0028");
    msg.set_string("text0029","text0029");
    msg.set_string("text0030","text0030");
    msg.set_string("text0031","text0031");
    msg.set_string("text0032","text0032");
    msg.set_string("text0033","text0033");
    msg.set_string("text0034","text0034");
    msg.set_string("text0035","text0035");
    msg.set_string("text0036","text0036");
    msg.set_string("text0037","text0037");
    msg.set_string("text0038","text0038");
    msg.set_string("text0039","text0039");
    msg.set_string("text0040","text0040");
    msg.set_string("text0041","text0041");
    msg.set_string("text0042","text0042");
    msg.set_string("text0043","text0043");
    msg.set_string("text0044","text0044");
    msg.set_string("text0045","text0045");
    msg.set_string("text0046","text0046");
    msg.set_string("text0047","text0047");
    msg.set_string("text0048","text0048");
    msg.set_string("text0049","text0049");
    msg.set_string("text0050","text0050");
    msg.set_string("text0051","text0051");
    msg.set_string("text0052","text0052");
    msg.set_string("text0053","text0053");
    msg.set_string("text0054","text0054");
    msg.set_string("text0055","text0055");
    msg.set_string("text0056","text0056");
    msg.set_string("text0057","text0057");
    msg.set_string("text0058","text0058");
    msg.set_string("text0059","text0059");
    msg.set_string("text0060","text0060");
    msg.set_string("text0061","text0061");
    msg.set_string("text0062","text0062");
    msg.set_string("text0063","text0063");
    msg.set_string("text0064","text0064");
    msg.set_string("text0065","text0065");
    msg.set_string("text0066","text0066");
    msg.set_string("text0067","text0067");
    msg.set_string("text0068","text0068");
    msg.set_string("text0069","text0069");
    msg.set_string("text0070","text0070");
    msg.set_string("text0071","text0071");
    msg.set_string("text0072","text0072");
    msg.set_string("text0073","text0073");
    msg.set_string("text0074","text0074");
    msg.set_string("text0075","text0075");
    msg.set_string("text0076","text0076");
    msg.set_string("text0077","text0077");
    msg.set_string("text0078","text0078");
    msg.set_string("text0079","text0079");
    msg.set_string("text0080","text0080");
    msg.set_string("text0081","text0081");
    msg.set_string("text0082","text0082");
    msg.set_string("text0083","text0083");
    msg.set_string("text0084","text0084");
    msg.set_string("text0085","text0085");
    msg.set_string("text0086","text0086");
    msg.set_string("text0087","text0087");
    msg.set_string("text0088","text0088");
    msg.set_string("text0089","text0089");
    msg.set_string("text0090","text0090");
    msg.set_string("text0091","text0091");
    msg.set_string("text0092","text0092");
    msg.set_string("text0093","text0093");
    msg.set_string("text0094","text0094");
    msg.set_string("text0095","text0095");
    msg.set_string("text0096","text0096");
    msg.set_string("text0097","text0097");
    msg.set_string("text0098","text0098");
    msg.set_string("text0099","text0099");
    msg.set_string("text0100","text0100");
    msg.set_string("text0101","text0101");
  }

  void on_level_start() {
    spr.add_sprite_set("script");
    sansAnimator.setXY(X1, Y1);
  }

  void step(int) { 
  }

  void draw(float subframe) {
    int frame = 1;
    int palette = 1;
    float X2 = 0;
    float Y2 = 0;
    frame_count++;
    sansAnimator.walkRightDark(frame_count, spr);
    sansAnimator.openTextbox(g, spr);
  }
}

class sansSprite {
    array<string> darkWalkingR;
    array<string> face;
    array<string> font;
    int startX, startY;
    int curFrame;
    uint colour = 0xFFFFFFFF;
    int walkSpeed;
    int a;
    int changeText;

    sansSprite(array<string>darkWalkingSprites, array<string>faceSprites, array<string>fontSprites) {
        a = 0;
        walkSpeed = 50;
        darkWalkingR = darkWalkingSprites;
        face = faceSprites;
        font = fontSprites;
        startX = 0;
        startY = 0;
        curFrame = 0;
        changeText = 0;
    }

    void setXY(int x, int y) {
        startX = x;
        startY = y;
    }

    void walkRightDark(int frame, sprites@ spr) {
        spr.draw_world(19, 19, darkWalkingR[curFrame], 0, 1, startX+frame/1.5, (((curFrame+1)%2)*4)+startY,
                0, .8, .8, colour);

        if(frame%walkSpeed == 0) {
            curFrame = curFrame + 1 >= darkWalkingR.size() ? 0 : curFrame+1;
        }

        if(frame%30 == 0) {
            changeText++;
        }
        if(changeText >=font.size()) {
            changeText = 0;
        }

        if(frame%80==0)
            a= (a+1)%101;
    }

    void openTextbox(scene@ g, sprites@ spr) {
        /* void draw_hud(int layer, int sub_layer, string spriteName,
                         uint32 frame, uint32 palette, float x, float y, float rotation,
                         float scale_x, float scale_y, uint32 colour);*/

        g.draw_rectangle_hud(19, 17, -650, 200, 650, 425, 0, 0xFFFFFFFF);
        g.draw_rectangle_hud(19, 18, -640, 210, 640, 415,0, 0xFF000000);

        //San's face
        spr.draw_hud(19, 19, face[0], 1, 1, -600, 260, 0, .75, .75, colour);

        //Asterisk 
        spr.draw_hud(20, 20, font[69], 1, 1, -425, 250, 0, .35, .35, colour); 

rectangle@ r = spr.get_sprite_rect("text0001", 0);
    //TODO: add text generation logic using sprite rectangles
   // puts(""+r.get_width());
spr.draw_hud(20, 20, font[58], 1, 1, -400+(45*1), 250, 0, .35, .35, colour);
spr.draw_hud(20, 20, font[72], 1, 1, -400+(75), 260, 0, .35, .35, colour);
spr.draw_hud(20, 20, font[16], 1, 1, -400+(80+25), 260, 0, .35, .35, colour);
spr.draw_hud(20, 20, font[96], 1, 1, -400+(105+35), 277, 0, .35, .35, colour);
        /*for(int i=1; i<10; i++) {
            spr.draw_hud(20, 20, font[i], 1, 1, -400+(45*i), 250, 0, .35, .35, colour);
        }*/
        
    }
}