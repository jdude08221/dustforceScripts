const int NUM_FRAMES = 175;
const string EMBED_out1 = "frames/out1.png"; 
const string EMBED_out2 = "frames/out2.png"; 
const string EMBED_out3 = "frames/out3.png"; 
const string EMBED_out4 = "frames/out4.png"; 
const string EMBED_out5 = "frames/out5.png"; 
const string EMBED_out6 = "frames/out6.png"; 
const string EMBED_out7 = "frames/out7.png"; 
const string EMBED_out8 = "frames/out8.png"; 
const string EMBED_out9 = "frames/out9.png"; 
const string EMBED_out10 = "frames/out10.png"; 
const string EMBED_out11 = "frames/out11.png"; 
const string EMBED_out12 = "frames/out12.png"; 
const string EMBED_out13 = "frames/out13.png"; 
const string EMBED_out14 = "frames/out14.png"; 
const string EMBED_out15 = "frames/out15.png"; 
const string EMBED_out16 = "frames/out16.png"; 
const string EMBED_out17 = "frames/out17.png"; 
const string EMBED_out18 = "frames/out18.png"; 
const string EMBED_out19 = "frames/out19.png"; 
const string EMBED_out20 = "frames/out20.png"; 
const string EMBED_out21 = "frames/out21.png"; 
const string EMBED_out22 = "frames/out22.png"; 
const string EMBED_out23 = "frames/out23.png"; 
const string EMBED_out24 = "frames/out24.png"; 
const string EMBED_out25 = "frames/out25.png"; 
const string EMBED_out26 = "frames/out26.png"; 
const string EMBED_out27 = "frames/out27.png"; 
const string EMBED_out28 = "frames/out28.png"; 
const string EMBED_out29 = "frames/out29.png"; 
const string EMBED_out30 = "frames/out30.png"; 
const string EMBED_out31 = "frames/out31.png"; 
const string EMBED_out32 = "frames/out32.png"; 
const string EMBED_out33 = "frames/out33.png"; 
const string EMBED_out34 = "frames/out34.png"; 
const string EMBED_out35 = "frames/out35.png"; 
const string EMBED_out36 = "frames/out36.png"; 
const string EMBED_out37 = "frames/out37.png"; 
const string EMBED_out38 = "frames/out38.png"; 
const string EMBED_out39 = "frames/out39.png"; 
const string EMBED_out40 = "frames/out40.png"; 
const string EMBED_out41 = "frames/out41.png"; 
const string EMBED_out42 = "frames/out42.png"; 
const string EMBED_out43 = "frames/out43.png"; 
const string EMBED_out44 = "frames/out44.png"; 
const string EMBED_out45 = "frames/out45.png"; 
const string EMBED_out46 = "frames/out46.png"; 
const string EMBED_out47 = "frames/out47.png"; 
const string EMBED_out48 = "frames/out48.png"; 
const string EMBED_out49 = "frames/out49.png"; 
const string EMBED_out50 = "frames/out50.png"; 
const string EMBED_out51 = "frames/out51.png"; 
const string EMBED_out52 = "frames/out52.png"; 
const string EMBED_out53 = "frames/out53.png"; 
const string EMBED_out54 = "frames/out54.png"; 
const string EMBED_out55 = "frames/out55.png"; 
const string EMBED_out56 = "frames/out56.png"; 
const string EMBED_out57 = "frames/out57.png"; 
const string EMBED_out58 = "frames/out58.png"; 
const string EMBED_out59 = "frames/out59.png"; 
const string EMBED_out60 = "frames/out60.png"; 
const string EMBED_out61 = "frames/out61.png"; 
const string EMBED_out62 = "frames/out62.png"; 
const string EMBED_out63 = "frames/out63.png"; 
const string EMBED_out64 = "frames/out64.png"; 
const string EMBED_out65 = "frames/out65.png"; 
const string EMBED_out66 = "frames/out66.png"; 
const string EMBED_out67 = "frames/out67.png"; 
const string EMBED_out68 = "frames/out68.png"; 
const string EMBED_out69 = "frames/out69.png"; 
const string EMBED_out70 = "frames/out70.png"; 
const string EMBED_out71 = "frames/out71.png"; 
const string EMBED_out72 = "frames/out72.png"; 
const string EMBED_out73 = "frames/out73.png"; 
const string EMBED_out74 = "frames/out74.png"; 
const string EMBED_out75 = "frames/out75.png"; 
const string EMBED_out76 = "frames/out76.png"; 
const string EMBED_out77 = "frames/out77.png"; 
const string EMBED_out78 = "frames/out78.png"; 
const string EMBED_out79 = "frames/out79.png"; 
const string EMBED_out80 = "frames/out80.png"; 
const string EMBED_out81 = "frames/out81.png"; 
const string EMBED_out82 = "frames/out82.png"; 
const string EMBED_out83 = "frames/out83.png"; 
const string EMBED_out84 = "frames/out84.png"; 
const string EMBED_out85 = "frames/out85.png"; 
const string EMBED_out86 = "frames/out86.png"; 
const string EMBED_out87 = "frames/out87.png"; 
const string EMBED_out88 = "frames/out88.png"; 
const string EMBED_out89 = "frames/out89.png"; 
const string EMBED_out90 = "frames/out90.png"; 
const string EMBED_out91 = "frames/out91.png"; 
const string EMBED_out92 = "frames/out92.png"; 
const string EMBED_out93 = "frames/out93.png"; 
const string EMBED_out94 = "frames/out94.png"; 
const string EMBED_out95 = "frames/out95.png"; 
const string EMBED_out96 = "frames/out96.png"; 
const string EMBED_out97 = "frames/out97.png"; 
const string EMBED_out98 = "frames/out98.png"; 
const string EMBED_out99 = "frames/out99.png"; 
const string EMBED_out100 = "frames/out100.png"; 
const string EMBED_out101 = "frames/out101.png"; 
const string EMBED_out102 = "frames/out102.png"; 
const string EMBED_out103 = "frames/out103.png"; 
const string EMBED_out104 = "frames/out104.png"; 
const string EMBED_out105 = "frames/out105.png"; 
const string EMBED_out106 = "frames/out106.png"; 
const string EMBED_out107 = "frames/out107.png"; 
const string EMBED_out108 = "frames/out108.png"; 
const string EMBED_out109 = "frames/out109.png"; 
const string EMBED_out110 = "frames/out110.png"; 
const string EMBED_out111 = "frames/out111.png"; 
const string EMBED_out112 = "frames/out112.png"; 
const string EMBED_out113 = "frames/out113.png"; 
const string EMBED_out114 = "frames/out114.png"; 
const string EMBED_out115 = "frames/out115.png"; 
const string EMBED_out116 = "frames/out116.png"; 
const string EMBED_out117 = "frames/out117.png"; 
const string EMBED_out118 = "frames/out118.png"; 
const string EMBED_out119 = "frames/out119.png"; 
const string EMBED_out120 = "frames/out120.png"; 
const string EMBED_out121 = "frames/out121.png"; 
const string EMBED_out122 = "frames/out122.png"; 
const string EMBED_out123 = "frames/out123.png"; 
const string EMBED_out124 = "frames/out124.png"; 
const string EMBED_out125 = "frames/out125.png"; 
const string EMBED_out126 = "frames/out126.png"; 
const string EMBED_out127 = "frames/out127.png"; 
const string EMBED_out128 = "frames/out128.png"; 
const string EMBED_out129 = "frames/out129.png"; 
const string EMBED_out130 = "frames/out130.png"; 
const string EMBED_out131 = "frames/out131.png"; 
const string EMBED_out132 = "frames/out132.png"; 
const string EMBED_out133 = "frames/out133.png"; 
const string EMBED_out134 = "frames/out134.png"; 
const string EMBED_out135 = "frames/out135.png"; 
const string EMBED_out136 = "frames/out136.png"; 
const string EMBED_out137 = "frames/out137.png"; 
const string EMBED_out138 = "frames/out138.png"; 
const string EMBED_out139 = "frames/out139.png"; 
const string EMBED_out140 = "frames/out140.png"; 
const string EMBED_out141 = "frames/out141.png"; 
const string EMBED_out142 = "frames/out142.png"; 
const string EMBED_out143 = "frames/out143.png"; 
const string EMBED_out144 = "frames/out144.png"; 
const string EMBED_out145 = "frames/out145.png"; 
const string EMBED_out146 = "frames/out146.png"; 
const string EMBED_out147 = "frames/out147.png"; 
const string EMBED_out148 = "frames/out148.png"; 
const string EMBED_out149 = "frames/out149.png"; 
const string EMBED_out150 = "frames/out150.png"; 
const string EMBED_out151 = "frames/out151.png"; 
const string EMBED_out152 = "frames/out152.png"; 
const string EMBED_out153 = "frames/out153.png"; 
const string EMBED_out154 = "frames/out154.png"; 
const string EMBED_out155 = "frames/out155.png"; 
const string EMBED_out156 = "frames/out156.png"; 
const string EMBED_out157 = "frames/out157.png"; 
const string EMBED_out158 = "frames/out158.png"; 
const string EMBED_out159 = "frames/out159.png"; 
const string EMBED_out160 = "frames/out160.png"; 
const string EMBED_out161 = "frames/out161.png"; 
const string EMBED_out162 = "frames/out162.png"; 
const string EMBED_out163 = "frames/out163.png"; 
const string EMBED_out164 = "frames/out164.png"; 
const string EMBED_out165 = "frames/out165.png"; 
const string EMBED_out166 = "frames/out166.png"; 
const string EMBED_out167 = "frames/out167.png"; 
const string EMBED_out168 = "frames/out168.png"; 
const string EMBED_out169 = "frames/out169.png"; 
const string EMBED_out170 = "frames/out170.png"; 
const string EMBED_out171 = "frames/out171.png"; 
const string EMBED_out172 = "frames/out172.png"; 
const string EMBED_out173 = "frames/out173.png"; 
const string EMBED_out174 = "frames/out174.png"; 
const string EMBED_out175 = "frames/out175.png"; 

const string EMBED_sound1 = "Howard_The_Alien_ORIGINAL_VIDEO.ogg"; 

class script : callback_base{
  int frame_count;
  int draw_frame_count;
  int curSpriteIndex;
  audio@ badSong;
  sprites@ spr;
  scene@ g;
  bool playing;
  [text] int layer;
  [text] int scaleSpeed;
  [text] bool showSprite;
  [position,mode:world,layer:19,y:Y1] float X1;

  [hidden] float Y1;
  [hidden] float scale;
  [hidden] float volume;
  
  array<string>framesGlobal(NUM_FRAMES);
  script() {
    @g = get_scene();
    X1 = 0;
    Y1 = 0;
    layer = 20;
    scale = 0;
    frame_count = 0;
    draw_frame_count = 0;
    playing = false;
    curSpriteIndex = 0;
    @spr = create_sprites();
    framesGlobal[0] = "out1";
  }

  void build_sprites(message@ msg) {    
    for(int i = 1; i <= NUM_FRAMES; i++) {
      msg.set_string("out"+i,"out"+i); 
    }
  }

  void build_sounds(message@ msg) {
    msg.set_string(EMBED_sound1.split(".")[0], "sound1");
  }

  void on_level_start() {
    //Populate names of frames into global frame array
    for(int i = 1; i <= NUM_FRAMES; i++) {
      framesGlobal[i-1] = "out" + i;
    }

    playing = false;
    spr.add_sprite_set("script");  
    scale = 0;
  }

  void step(int) {
    //Only advance animation frame every 6 game ticks
    if(frame_count%8 == 0) {
      curSpriteIndex++;
    }

    frame_count++;

    //update the volume slowly
    if(badSong != null) {
      badSong.volume(volume);
    }

    if(frame_count % scaleSpeed == 0) {
      volume += .0001;
      if(scale < 15) {
        scale+=.0015;
      }
    }
  }

  void editor_draw(float subframe) {
    if(showSprite) {
      spr.draw_world(layer, 1, framesGlobal[0], 0, 1, X1, Y1, 0, 1, 1, 0xFFFFFFFF);
    }
  }

  void editor_step() {
    spr.add_sprite_set("script");  
  }

  void draw(float subframe) {
    if(!playing) {
      @badSong = g.play_script_stream(EMBED_sound1.split(".")[0], 3, 0, 0, true, 1 );
      playing = true;
    }
    
    spr.draw_world(layer, 1, framesGlobal[curSpriteIndex % NUM_FRAMES], 0, 1, X1-scale, Y1-scale, 0, scale, scale, 0xFFFFFFFF);
    draw_frame_count++;
  }
}